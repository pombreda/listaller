# CMakeLists for Listaller-Qt

find_package(Qt4 REQUIRED)
include(${QT_USE_FILE})
find_package(PkgConfig REQUIRED)
find_package(GLIB2 REQUIRED)
pkg_check_modules(GEE REQUIRED gee-1.0)

set(listaller-qt_SRCS
    limanager.cpp
    lisetup.cpp
)

set(listaller-qt_HEADERS
   litypes.h
   limanager.h
   lisetup.h
)

set(listaller-qt_INST_HEADERS Listaller-Qt
   litypes.h
   limanager.h
   lisetup.h
)

qt4_wrap_cpp(listaller-qt_MOC_SRCS ${listaller-qt_HEADERS})

remove_definitions ("--include config.h")
add_definitions (${QT_DEFINITIONS})
add_definitions (-DQT_PLUGIN)
add_definitions (-DQT_NO_DEBUG)
add_definitions (-DQT_SHARED)

link_directories(${CMAKE_BINARY_DIR})
include_directories(${CMAKE_SOURCE_DIR}
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CMAKE_CURRENT_BINARY_DIR}
    ${qt4_include_dir}
    ${GLIB2_INCLUDE_DIR}
    ${GEE_INCLUDE_DIRS}
    ${CMAKE_CURRENT_BINARY_DIR}/..
)

add_library(listaller-qt SHARED ${listaller-qt_SRCS} ${listaller-qt_MOC_SRCS})

if(NOT LILIBS_FULL_VERSION)
 message(FATAL_ERROR "Library version not defined. (This should never happen)")
endif()

set_target_properties(listaller-qt PROPERTIES VERSION ${LILIBS_FULL_VERSION} SOVERSION ${LILIBS_SOVERSION})

target_link_libraries(listaller-qt
	${GLIB2_LIBRARIES}
	${GEE_LIBRARIES}
	${QT_QTCORE_LIBRARY}
	"listaller-glib"
)

configure_file(${CMAKE_CURRENT_SOURCE_DIR}/listaller-qt.pc.in
  ${CMAKE_CURRENT_BINARY_DIR}/listaller-qt.pc
  @ONLY
)

install(TARGETS listaller-qt DESTINATION ${CMAKE_INSTALL_LIBDIR})
install(FILES ${CMAKE_CURRENT_BINARY_DIR}/listaller-qt.pc DESTINATION ${CMAKE_INSTALL_LIBDIR}/pkgconfig COMPONENT headers)
install(FILES ${listaller-qt_INST_HEADERS} DESTINATION include/listaller-qt COMPONENT headers)
